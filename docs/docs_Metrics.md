# 📏 CatPrism Metric 정의 문서 (docs/Metrics)

CatPrism DSL에서는 사상 간 왜곡(distortion)을 수치적으로 표현하기 위해,
다양한 형태의 메트릭(metric)을 정의하고 사용할 수 있습니다.

---

## 🎯 메트릭의 목적

- 펑터 F가 합성 보존을 얼마나 잘 만족시키는지 정량화함
- 실제 구조의 왜곡 허용 오차(ε)를 설정하기 위한 기준 제공
- Lean에서 증명 시, 펑터의 `comp_ok` 속성을 만족시키는 조건이 됨

---

## ✅ 지원 메트릭 종류

### 1. PhaseDist

```cat
metric PhaseDist {
  lambda (f,g) => abs(phase(f) - phase(g))
}
```

| 특징        | 설명                                         |
|-------------|----------------------------------------------|
| 목적        | 각도를 기준으로 한 사상 간 위상 왜곡 측정    |
| 사용 분야   | 회전, 위상 기반 구조                          |
| 값 범위     | [0, π]                                       |

---

### 2. LengthDist

```cat
metric LengthDist {
  lambda (f,g) => abs(len(f) - len(g))
}
```

| 특징        | 설명                                         |
|-------------|----------------------------------------------|
| 목적        | 사상의 '길이' 또는 '규모' 차이를 기준으로 측정 |
| 사용 분야   | 벡터 공간, 스케일 변화                         |
| 값 범위     | ≥ 0                                           |

---

### 3. Δzero

```cat
metric Δzero {
  lambda (f,g) => 0
}
```

| 특징        | 설명                                              |
|-------------|---------------------------------------------------|
| 목적        | 모든 사상 쌍 간 거리를 0으로 간주 (정확 보존용)      |
| 사용 분야   | 전통적인 forgetful functor, 그룹 → 집합 등            |
| 값 범위     | 항상 0                                            |

---

## 🧠 메트릭 적용 흐름 요약

1. `.cat` 파일에서 `metric ... { lambda ... }` 선언
2. `functor ... { distortion_metric: <metric_name> }`로 연결
3. 파서 → `Metric { name, lambda }` 구조 생성
4. Lean 템플릿에 치환되어 `δ := <metric>` 로 생성됨
5. `verify_comp` 전술이 이 δ에 기반한 합성 보존 조건 증명

---

## 📘 참고

- `phase(f)`는 사상의 위상 (예: det → arctan2)
- `len(f)`는 사상의 크기/길이, 일반적으로 ||f||
- 실제 Lean 증명에서는 이 값들을 추상화한 함수로 구현해야 함

---

CatPrism의 메트릭은 단순한 거리 개념이 아니라,
**구조적 보존과 의미론적 연결성을 수학적으로 정량화하는 도구**입니다.
